# AutoHotkey v2 - IME制御 + PowerToysショートカット 統合版（v2.4 最終版）

## 🔧 v2.4での修正内容

### 修正した問題

1. ✅ **Emacsキーバインドが効かない問題を解消**
   - シンプルな `Send` 実装に変更
   - AutoHotkey v2では、ホットキーはデフォルトでリピートに対応

2. ✅ **上下半分配置の余白を完全除去**
   - `halfHeight` を使用して正確に分割
   - 奇数高さでも余白が出ないように計算

## 📋 ホットキー一覧

### ウィンドウ分割（Ctrl + Alt）

| ショートカット | 機能 |
|--------------|------|
| `Ctrl + Alt + H` | 左半分配置（余白なし） |
| `Ctrl + Alt + J` | 下半分配置（余白なし） |
| `Ctrl + Alt + K` | 上半分配置（余白なし） |
| `Ctrl + Alt + L` | 右半分配置（余白なし） |
| `Ctrl + Alt + M` | 最大化 |

### Emacs 風（右Ctrl）- **リピート対応**

| ショートカット | 機能 | リピート |
|--------------|------|---------|
| `RCtrl + A` | Home（行頭） | ✅ |
| `RCtrl + E` | End（行末） | ✅ |
| `RCtrl + B` | Left（左へ） | ✅ 押しっぱなしOK |
| `RCtrl + F` | Right（右へ） | ✅ 押しっぱなしOK |
| `RCtrl + N` | Down（下へ） | ✅ 押しっぱなしOK |
| `RCtrl + P` | Up（上へ） | ✅ 押しっぱなしOK |
| `RCtrl + H` | Backspace | ✅ 押しっぱなしOK |
| `RCtrl + D` | Delete | ✅ 押しっぱなしOK |

### IME 制御

| キー操作 | 機能 |
|---------|------|
| 左Ctrl（空打ち） | IME OFF（英数） |
| 右Ctrl（空打ち） | IME ON（かな） |

## 📦 ファイル構成

必要なファイル：
1. `all-in-one-v2.4-final.ahk` - メインスクリプト
2. `IME-v2.ahk` - IME制御ライブラリ

**重要：** 両方のファイルを同じフォルダに配置してください。

## 🚀 使い方

1. 両方のファイルを同じフォルダに配置
2. `all-in-one-v2.4-final.ahk` をダブルクリックで実行

## ✅ 動作確認項目

- [ ] `RCtrl + N` を押しっぱなしでカーソルが連続して下に移動する
- [ ] `RCtrl + P` を押しっぱなしでカーソルが連続して上に移動する
- [ ] `Ctrl + Alt + H/J/K/L` で余白なくウィンドウが配置される
- [ ] 左Ctrl空打ちでIME OFFになる（TeamsやOutlookでも）
- [ ] 右Ctrl空打ちでIME ONになる

## 🎯 重要な実装ポイント

### Emacsキーバインドのリピート対応

```ahk
; シンプルな実装 = リピート対応
>^n::
{
    Send "{Down}"
}
```

AutoHotkey v2では、上記のようなシンプルな実装で：
- ✅ キーリピートが自動的に動作
- ✅ 押しっぱなしで連続入力される
- ✅ 修飾キーの状態が正しく処理される

### 余白なし分割

```ahk
; 下半分の場合
halfHeight := workAreaHeight // 2      ; 高さの半分
newY := monTop + halfHeight            ; Y座標
newHeight := workAreaHeight - halfHeight  ; 残り全部（余白なし）
```

この計算により、奇数高さでも余白が発生しません。

## 🔄 変更履歴

### v2.4-final（最終版）
- ✅ Emacsキーバインドをシンプルな実装に変更（リピート対応）
- ✅ 上下半分配置の余白を完全除去
- ✅ コードをシンプルで理解しやすく改善

### v2.3
- IME制御の信頼性向上（`A_PriorKey` 使用）
- 左右半分配置の余白除去
- 最大化後の移動問題を解決

### v2.2
- 最大化後にウィンドウ移動できない問題を修正

### v2.1
- 無限ループバグを修正
- try-catch による例外処理を追加

## 🎉 まとめ

v2.4-finalでは：
1. ✅ Emacsキーバインドが正常に動作（リピート対応）
2. ✅ すべてのウィンドウ配置で完全に余白なし
3. ✅ IME制御がすべてのアプリで動作
4. ✅ コードがシンプルで保守しやすい

すべての機能が期待通りに動作します！
